<%- include ../layout/header %>

<h1><%= title.slice(0, title.lastIndexOf(" -")) %></h1>

<% if (messages.success) { %>
  <div class="alert alert-success my-3">
    <%= messages.success %>
  </div>
<% } %>

<form method="POST" class="form">
  <div class="form-group">
    <label for="title">Title:</label>
    <input type="text" class="form-control" id="title" name="title" value="<%= survey.title %>">
  </div>

  <div class="form-group">
    <label for="title">Description:</label>
    <textarea class="form-control" id="description" name="description"><%= survey.description %></textarea>
  </div>

  <h3>Questions</h3>

  <% for (let i = 0; i <= survey.questions.length; i++) { %>
    <%
    const q = i < survey.questions.length ? survey.questions[i] : {
      _id: 0,
      title: "",
      type: "radio",
      options: [],
    };
    %>

    <h5>Question <%= i + 1 %></h5>

    <div class="mb-3">
      <div class="form-group">
        <label for="title-<%= q._id %>">Title:</label>
        <input type="text" class="form-control" id="title-<%= q._id %>" name="question_title[]" value="<%= q.question %>">
      </div>

      <div class="form-group">
        <label for="type-<%= q._id %>">Type:</label>
        <select name="question_type[]" id="type-<%= q._id %>" class="custom-select">
          <option value="input" <%= q.type === "input" ? "selected" : "" %>>Short answer</option>
          <option value="textarea" <%= q.type === "textarea" ? "selected" : "" %>>Long answer</option>
          <option value="radio" <%= q.type === "radio" ? "selected" : "" %>>Multiple choice (select 1)</option>
          <option value="checkbox" <%= q.type === "checkbox" ? "selected" : "" %>>Multiple choice (select multiple)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="options-<%= q._id %>">Options (multiple choice only; separate different options by semicolon <kbd>;</kbd>):</label>
        <input type="text" class="form-control" id="options-<%= q._id %>" name="question_options[]" value="<%= q.options.join(";") %>">
      </div>
    </div>
    <hr class="my-3">
  <% } %>

  <div class="small">
    <i>Save the survey to add another question. To remove a question, empty the question's title.</i>
  </div>

  <div class="row justify-content-center mt-4">
    <div class="col-auto text-center">
      <button type="submit" class="btn btn-primary">
        Save survey
      </button>

      <% if (!isNew) { %>
        <a href="/survey/<%= survey._id %>/delete" class="btn btn-danger require-confirmation">
          Delete survey
        </a>
      <% } %>

      <div class="mt-2">
        <a href="/survey" class="btn btn-secondary">
          Cancel
        </a>
      </div>
    </div>
  </div>
</form>

<%- include ../layout/footer %>
